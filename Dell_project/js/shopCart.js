"use strict";var _createClass=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}$(function(){var t=getCookie("login");if(!t)return $(".div_mark").toggle(),login_btn(),login_register(),$(".panel").html('<h1 style="padding-left:30px; color:red;">未登录，购物车没有东西</h1><p style="padding-left:30px;"><a style="text-decoration:underline;" href="../index.html">点击跳转至首页</a></p>'),void e();function e(){var t=!0;$(".area_btn").on("click",function(){t=t?($(this).css({background:"url(../images/area_btn.jpg) 104px 18px no-repeat"}),!1):($(this).css({background:"url(../images/area_btn.jpg) 104px -18px no-repeat"}),!0)});var e=!0;$(".fixde_div").on("click",function(){if(e)return $(".fixed_contact").css({right:-264}),void(e=!1);$(".fixed_contact").css({right:-5}),e=!0})}$(".my_login").html(t),$(".login_register").on("mousedown",function(){$(".login_right").html('<h2 class="exit_login"><span>退出登录</span></h2>'),$(".login_right span").on("click",function(){localStorage.setItem("url",location.href.split("#")[0]);var t=localStorage.getItem("url");location.href=t,localStorage.removeItem("url"),document.cookie="login=login;expires="+new Date(0)+";path=/Dell_project;",document.cookie="number=number;expires="+new Date(0)+";path=/Dell_project;"})}),$(".continue_btn").on("click",function(){location.href="../index.html"}),new(function(){function n(t,e){_classCallCheck(this,n),this.ele=$(t),this.tel=e,this.total_price=$(".price span"),this.deAll=$(".clear_btn"),this.buy_btn=$(".buy_btn"),this.badge=$(".badge"),this.init()}return _createClass(n,[{key:"init",value:function(){var n=this;this.getAllGood(),this.deleteAll(),this.buybtn(),this.ele.on("click",function(t){var e=t.target;n.idx=e.getAttribute("idx"),n.idx&&(n.num=n.data.find(function(t){return t.goods_id==n.idx}).goods_num),e.classList.contains("input_add")&&n.add(),e.classList.contains("input_reduce")&&n.reduce(),e.classList.contains("delete_btn")&&n.delete(),n.count()})}},{key:"getAllGood",value:function(){var n=this;$.get({url:"../api/details.json",success:function(e){e.forEach(function(t,e){t.goods_id=e+1}),$.get({url:"../api/getgood.php",data:{tel:n.tel},success:function(t){t=JSON.parse(t),n.data=[],e.forEach(function(e){t.forEach(function(t){if(e.goods_id==t.goods_id)return e.goods_num=t.goods_num,void n.data.push(e)})}),n.renderCar()}})}})}},{key:"renderCar",value:function(){var e="";this.data.forEach(function(t){e+=' <tr idx="'+t.goods_id+'">\n                                                    <td><div class="" >'+t.left+'</div></td>\n                                                    <td>\n                                                        <a href="#">\n                                                            '+t.riht_title+"\n                                                        </a>\n                                                    </td>\n                                                    <td>"+t.xinhao+'</td>\n                                                    <td>\n                                                        <div class="products_div_text  number">\n                                                            <div class="btn-group" role="group" style="margin-right: 5px;">\n                                                                <button type="button" idx="'+t.goods_id+'" class="btn btn-default input_reduce">-</button>\n                                                                <button type="button" class="btn btn-default input_num">'+t.goods_num+'</button>\n                                                                <button type="button" idx="'+t.goods_id+'" class="btn btn-default input_add">+</button>\n                                                            </div>\n                                                        </div>\n                                                    </td>\n                                                    <td>\n                                                    '+(t.cs_price?' <div class="sigle_price">\n                                                                <span> ￥ '+t.cs_price+'</span>\n                                                            </div>\n                                                            <div style="text-align: center;">\n                                                                折扣：\n                                                            </div>':" <span>￥ "+t.th_price+"</span>")+"\n\n                                                    </td>\n                                                    <td>\n                                                    "+(t.cs_price?' <div class="sigle_price">\n                                                                <span>￥ '+t.th_price*t.goods_num+"</span>\n                                                            </div>\n                                                            <div>\n                                                                ￥ "+t.zk_price+"\n                                                            </div>":" <span>￥ "+t.th_price*t.goods_num+"</span>")+'\n\n                                                    </td>\n                                                    <td><a href="#" class="delete_btn" idx="'+t.goods_id+'" style="text-decoration:underline;">删除</a></td>\n                                                </tr>'}),this.ele.html(e),this.ele.html()||this.ele.parents(".panel").html('<h1 style="padding-left:30px; color:red;">你已清空购物车</h1><p style="padding-left:30px;"><a style="text-decoration:underline;" href="../index.html">点击跳转至首页</a></p>'),this.count()}},{key:"count",value:function(){this.number=this.data.reduce(function(t,e){return t+1*e.goods_num},0),this.price=this.data.reduce(function(t,e){return t+e.goods_num*e.th_price},0),this.total_price.html(this.price),document.cookie="number="+this.number+";path=/Dell_project;",this.badge.html(getCookie("number"))}},{key:"add",value:function(){var e=this;$.get({url:"../api/updategood.php",data:{tel:this.tel,goods_id:this.idx,goods_num:++this.num},success:function(t){1==(t=JSON.parse(t)).code&&e.data.forEach(function(t){t.goods_id==e.idx&&(t.goods_num=e.num,e.renderCar())})}})}},{key:"reduce",value:function(){var e=this;this.num<=1?alert("数量最少为1"):$.get({url:"../api/updategood.php",data:{tel:this.tel,goods_id:this.idx,goods_num:--this.num},success:function(t){1==(t=JSON.parse(t)).code&&e.data.forEach(function(t){t.goods_id==e.idx&&(t.goods_num=e.num,e.renderCar())})}})}},{key:"delete",value:function(){var e=this;$.get({url:"../api/removegood.php",data:{goods_id:this.idx,tel:this.tel},success:function(t){1==(t=JSON.parse(t)).code&&(e.data=e.data.filter(function(t){return t.goods_id!=e.idx}),e.renderCar())}})}},{key:"deleteAll",value:function(){var e=this;this.deAll.on("click",function(){$.get({url:"../api/removegood.php",data:{tel:e.tel,goods_id:null},success:function(t){1==(t=JSON.parse(t)).code&&(e.data=[],e.renderCar())}})})}},{key:"buybtn",value:function(){var e=this;this.buy_btn.on("click",function(){$.get({url:"../api/removegood.php",data:{tel:e.tel,goods_id:null},success:function(t){t=JSON.parse(t),alert("结算成功"),1==t.code&&(e.data=[],e.renderCar())}})})}}]),n}())(".tb",t),login_register(),e()});